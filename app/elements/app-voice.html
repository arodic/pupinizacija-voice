<script src="../scripts/cyrlatconverter-v0.6.1.js"></script>

<dom-module id="app-voice">
  <template>
    <voice-recognition id="webspeech"
        on-result="onResult"
        on-end="onEnd"
        on-start="onStart"
        on-error="onError">
    </voice-recognition>
  </template>
</dom-module>
<script>
(function (THREE) {

  var upitnereci = ['kako', 'gde', 'zašto', 'kada', 'koliko', 'ko je', 'ko su'];
  var running = false;
  var result;

  Polymer({
    is: 'app-voice',
    properties: {
      result: {
        type: String,
        notify: true
      }
    },
    ready: function () {
      var voice = this.$.webspeech;

      this.result = replaceL2C('Pritisni dugme!');

      // TODO: Dodaj ostale reci

      var startSpeech = function() {
        if (running) {
          return;
        }
        voice.recognition.lang = 'sr';
        voice.start();
      };

      var endSpeech = function() {
        voice.stop();
      };

      document.addEventListener('keydown', startSpeech);
      document.addEventListener('_keyup', endSpeech);
    },
    onResult: function () {
      console.log(this.$.webspeech.recognition, event.detail.result);
      result = event.detail.result;
      var reci = result.split(' ');
      if (reci[1] === 'li') {
        result += '?';
      } else {
        for (var i = 0; i < upitnereci.length; i++) {
          if (result.search(upitnereci[i]) === 0) {
            result += '?';
          }
        }
      }
      this.result = replaceL2C(result);
      this.$.webspeech.text = '';
    },
    onEnd: function () {
      this.result = replaceL2C('Slušanje prekinuto.');
      running = false;
    },
    onStart: function () {
      this.result = replaceL2C('Slušam...');
      running = true;
    },
    onError: function () {
      this.result = replaceL2C('Greška u slušanju.');
      running = false;
    }
  });
}(THREE));
</script>
