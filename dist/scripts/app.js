!function(e,i){var r=e.querySelector("#app");r.width=window.innerWidth,r.height=window.innerHeight;var a={minFilter:i.LinearFilter,magFilter:i.NearestFilter,format:i.RGBFormat},t=new i.WebGLRenderTarget(r.width,r.height,a),n=new i.WebGLRenderTarget(r.width,r.height,a),o=new i.Scene,d=new i.Mesh(new i.PlaneBufferGeometry(1,1),new i.MeshBasicMaterial({map:t}));d.position.x=-.5,o.add(d);var s=new i.Mesh(new i.PlaneBufferGeometry(1,1),new i.MeshBasicMaterial({map:n}));s.position.x=.5,o.add(s);var v=new i.OrthographicCamera(-1,1,.5,-.5,-100,100);r.scene=new i.Scene,r.camera=new i.PerspectiveCamera(90,r.width/r.height,.1,1e3),r.camera.position.set(0,4,40),r.camera.lookAt(new i.Vector3);var l=i.ImageUtils.loadTexture("images/grid.png");l.wrapS=i.RepeatWrapping,l.wrapT=i.RepeatWrapping,l.anisotropy=6;var u=i.ImageUtils.loadTexture("images/displace.jpg"),f=new i.ShaderMaterial({uniforms:{map:{type:"t",value:l},displace:{type:"t",value:u},audio:{type:"t",value:null}},vertexShader:["uniform sampler2D displace;","uniform sampler2D audio;","varying vec2 vUv;","varying float dist;","void main() {"," vUv = uv;"," dist = distance(uv * vec2(1.0, 0.5), vec2(0.35, 0.05));"," float audioColor = texture2DLod( audio, vec2(dist, 0.0), 2.0 ).r;"," float offset = texture2D( displace, uv ).r * 45.0 + audioColor * 4.0;"," vec4 mvPosition = modelViewMatrix * vec4( position + vec3(0.0, 0.0, offset), 1.0 );"," gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform sampler2D map;","uniform sampler2D audio;","varying vec2 vUv;","varying float dist;","void main() {"," vec4 texelColor = 10.0 * texture2D( map, vUv * vec2(150.0, 75.0) );"," float audioColor = texture2D( audio, vec2(dist, 0.0) ).r;","	gl_FragColor = vec4( texelColor.rgb * (1.0 + 10.0 * audioColor), 1.0 );","}"].join("\n")}),m=new i.Mesh(new i.PlaneBufferGeometry(150,75,150,75),f);m.rotation.x=-Math.PI/2,m.position.y=0,r.scene.add(m);for(var h=new i.ShaderMaterial({uniforms:i.UniformsUtils.merge([{audio:{type:"t",value:null}},field.uniforms]),vertexShader:[field.shaderChunk.params,"uniform sampler2D audio;",field.shaderChunk.functions,"varying vec2 vUv;","void main() {","vUv = uv;"," float offset = texture2D( audio, vec2(uv.x, 0.0) ).r * 22.;"," vec4 mvPosition = modelMatrix * vec4( position + vec3(0.0, offset, 0.0), 1.0 );"," float intensity = max(0.0, abs(mvPosition.x / 25.) - fintensity);"," vec3 field = getField(ftex, ftrans, finvTrans, mvPosition.xyz, fgrid, intensity);"," field.y *= 3.0;"," gl_Position = projectionMatrix * viewMatrix * (mvPosition + vec4(field, 0.0));","}"].join("\n"),fragmentShader:["uniform sampler2D audio;","varying vec2 vUv;","void main() {"," float alpha = min(1.0, abs(texture2D( audio, vec2(vUv.x, 0.0) ).r * 1000.));","	gl_FragColor = vec4( 1.0, 1.0, 1.0, alpha );","}"].join("\n"),transparent:!0,depthTest:!1}),c=2048,p=new i.BufferGeometry,w=new Float32Array(3*c),g=new Float32Array(2*c),x=0;c>x;x++){var y=-30+x/c*60,C=3.5,M=30;w[3*x]=y,w[3*x+1]=C,w[3*x+2]=M,g[2*x]=x/c,g[2*x+1]=x/c}p.addAttribute("position",new i.BufferAttribute(w,3)),p.addAttribute("uv",new i.BufferAttribute(g,2)),p.computeBoundingSphere();var P=new i.Line(p,h);r.scene.add(P),window.addEventListener("resize",function(){r.width=window.innerWidth,r.height=window.innerHeight,t=new i.WebGLRenderTarget(r.width,r.height,a),n=new i.WebGLRenderTarget(r.width,r.height,a),r.camera.aspect=r.width/r.height,r.camera.updateProjectionMatrix()}),r.onResultChanged=function(e){this.$.animation.addAnimation(this.scene,e.detail.value)};var T=function(){h.uniforms.ftex.value=field.texture,h.uniforms.ftrans.value=field.uniforms.ftrans.value,h.uniforms.finvTrans.value=field.uniforms.finvTrans.value,h.uniforms.audio.value=r.$.voice.waveHistoryTexture,f.uniforms.audio.value=r.$.voice.levelHistoryTexture,requestAnimationFrame(T),r.$.animation.update(),r.$.voice.update(),r.$.renderer.autoClear=!0,r.$.renderer.autoClearDepth=!0,r.$.renderer.autoClearColor=!0,r.$.renderer.autoClearAlpha=!0,r.$.renderer.autoClearStencil=!0,r.$.renderer.clear();var e=1.05;r.camera.setViewOffset(r.width,r.height,0,0,r.width/2*e,r.height),r.$.renderer.render(r.scene,r.camera,t,!0),r.camera.setViewOffset(r.width,r.height,r.width/2-e,0,r.width/2*e,r.height),r.$.renderer.render(r.scene,r.camera,n,!0),r.$.renderer.render(o,v)};r.addEventListener("dom-change",function(){T()})}(document,THREE),function(e,i){var r=e.querySelector("#app");r.width=window.innerWidth,r.height=window.innerHeight;var a={minFilter:i.LinearFilter,magFilter:i.NearestFilter,format:i.RGBFormat},t=new i.WebGLRenderTarget(r.width,r.height,a),n=new i.WebGLRenderTarget(r.width,r.height,a),o=new i.Scene,d=new i.Mesh(new i.PlaneBufferGeometry(1,1),new i.MeshBasicMaterial({map:t}));d.position.x=-.5,o.add(d);var s=new i.Mesh(new i.PlaneBufferGeometry(1,1),new i.MeshBasicMaterial({map:n}));s.position.x=.5,o.add(s);var v=new i.OrthographicCamera(-1,1,.5,-.5,-100,100);r.scene=new i.Scene,r.camera=new i.PerspectiveCamera(90,r.width/r.height,.1,1e3),r.camera.position.set(0,4,40),r.camera.lookAt(new i.Vector3);var l=i.ImageUtils.loadTexture("images/grid.png");l.wrapS=i.RepeatWrapping,l.wrapT=i.RepeatWrapping,l.anisotropy=6;var u=i.ImageUtils.loadTexture("images/displace.jpg"),f=new i.ShaderMaterial({uniforms:{map:{type:"t",value:l},displace:{type:"t",value:u},audio:{type:"t",value:null}},vertexShader:["uniform sampler2D displace;","uniform sampler2D audio;","varying vec2 vUv;","varying float dist;","void main() {"," vUv = uv;"," dist = distance(uv * vec2(1.0, 0.5), vec2(0.35, 0.05));"," float audioColor = texture2DLod( audio, vec2(dist, 0.0), 2.0 ).r;"," float offset = texture2D( displace, uv ).r * 45.0 + audioColor * 4.0;"," vec4 mvPosition = modelViewMatrix * vec4( position + vec3(0.0, 0.0, offset), 1.0 );"," gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform sampler2D map;","uniform sampler2D audio;","varying vec2 vUv;","varying float dist;","void main() {"," vec4 texelColor = 10.0 * texture2D( map, vUv * vec2(150.0, 75.0) );"," float audioColor = texture2D( audio, vec2(dist, 0.0) ).r;","	gl_FragColor = vec4( texelColor.rgb * (1.0 + 10.0 * audioColor), 1.0 );","}"].join("\n")}),m=new i.Mesh(new i.PlaneBufferGeometry(150,75,150,75),f);m.rotation.x=-Math.PI/2,m.position.y=0,r.scene.add(m);for(var h=new i.ShaderMaterial({uniforms:i.UniformsUtils.merge([{audio:{type:"t",value:null}},field.uniforms]),vertexShader:[field.shaderChunk.params,"uniform sampler2D audio;",field.shaderChunk.functions,"varying vec2 vUv;","void main() {","vUv = uv;"," float offset = texture2D( audio, vec2(uv.x, 0.0) ).r * 22.;"," vec4 mvPosition = modelMatrix * vec4( position + vec3(0.0, offset, 0.0), 1.0 );"," float intensity = max(0.0, abs(mvPosition.x / 25.) - fintensity);"," vec3 field = getField(ftex, ftrans, finvTrans, mvPosition.xyz, fgrid, intensity);"," field.y *= 3.0;"," gl_Position = projectionMatrix * viewMatrix * (mvPosition + vec4(field, 0.0));","}"].join("\n"),fragmentShader:["uniform sampler2D audio;","varying vec2 vUv;","void main() {"," float alpha = min(1.0, abs(texture2D( audio, vec2(vUv.x, 0.0) ).r * 1000.));","	gl_FragColor = vec4( 1.0, 1.0, 1.0, alpha );","}"].join("\n"),transparent:!0,depthTest:!1}),c=2048,p=new i.BufferGeometry,w=new Float32Array(3*c),g=new Float32Array(2*c),x=0;c>x;x++){var y=-30+x/c*60,C=3.5,M=30;w[3*x]=y,w[3*x+1]=C,w[3*x+2]=M,g[2*x]=x/c,g[2*x+1]=x/c}p.addAttribute("position",new i.BufferAttribute(w,3)),p.addAttribute("uv",new i.BufferAttribute(g,2)),p.computeBoundingSphere();var P=new i.Line(p,h);r.scene.add(P),window.addEventListener("resize",function(){r.width=window.innerWidth,r.height=window.innerHeight,t=new i.WebGLRenderTarget(r.width,r.height,a),n=new i.WebGLRenderTarget(r.width,r.height,a),r.camera.aspect=r.width/r.height,r.camera.updateProjectionMatrix()}),r.onResultChanged=function(e){this.$.animation.addAnimation(this.scene,e.detail.value)};var T=function(){h.uniforms.ftex.value=field.texture,h.uniforms.ftrans.value=field.uniforms.ftrans.value,h.uniforms.finvTrans.value=field.uniforms.finvTrans.value,h.uniforms.audio.value=r.$.voice.waveHistoryTexture,f.uniforms.audio.value=r.$.voice.levelHistoryTexture,requestAnimationFrame(T),r.$.animation.update(),r.$.voice.update(),r.$.renderer.autoClear=!0,r.$.renderer.autoClearDepth=!0,r.$.renderer.autoClearColor=!0,r.$.renderer.autoClearAlpha=!0,r.$.renderer.autoClearStencil=!0,r.$.renderer.clear();var e=1.05;r.camera.setViewOffset(r.width,r.height,0,0,r.width/2*e,r.height),r.$.renderer.render(r.scene,r.camera,t,!0),r.camera.setViewOffset(r.width,r.height,r.width/2-e,0,r.width/2*e,r.height),r.$.renderer.render(r.scene,r.camera,n,!0),r.$.renderer.render(o,v)};r.addEventListener("dom-change",function(){T()})}(document,THREE);