!function(e,i){var a=e.querySelector("#app");a.width=window.innerWidth,a.height=Math.floor(a.width/2),a.scene=new i.Scene,a.camera=new i.PerspectiveCamera(90,2,.1,1e3),a.camera.position.set(0,4,40),a.camera.lookAt(new i.Vector3);var t=i.ImageUtils.loadTexture("images/grid.png");t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,t.anisotropy=6;var r=i.ImageUtils.loadTexture("images/displace.jpg"),o=new i.ShaderMaterial({uniforms:{map:{type:"t",value:t},displace:{type:"t",value:r},audio:{type:"t",value:null}},vertexShader:["uniform sampler2D displace;","uniform sampler2D audio;","varying vec2 vUv;","varying float dist;","void main() {"," vUv = uv;"," dist = distance(uv * vec2(1.0, 0.5), vec2(0.35, 0.05));"," float audioColor = texture2DLod( audio, vec2(dist, 0.0), 2.0 ).r;"," float offset = texture2D( displace, uv ).r * 45.0 + audioColor * 4.0;"," vec4 mvPosition = modelViewMatrix * vec4( position + vec3(0.0, 0.0, offset), 1.0 );"," gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform sampler2D map;","uniform sampler2D audio;","varying vec2 vUv;","varying float dist;","void main() {"," vec4 texelColor = 10.0 * texture2D( map, vUv * vec2(150.0, 75.0) );"," float audioColor = texture2D( audio, vec2(dist, 0.0) ).r;","	gl_FragColor = vec4( texelColor.rgb * (1.0 + 10.0 * audioColor), 1.0 );","}"].join("\n")}),n=new i.Mesh(new i.PlaneBufferGeometry(150,75,150,75),o);n.rotation.x=-Math.PI/2,n.position.y=0,a.scene.add(n);for(var v=new i.ShaderMaterial({uniforms:i.UniformsUtils.merge([{audio:{type:"t",value:null}},field.uniforms]),vertexShader:[field.shaderChunk.params,"uniform sampler2D audio;",field.shaderChunk.functions,"varying vec2 vUv;","void main() {","vUv = uv;"," float offset = texture2D( audio, vec2(uv.x, 0.0) ).r * 22.;"," vec4 mvPosition = modelMatrix * vec4( position + vec3(0.0, offset, 0.0), 1.0 );"," float intensity = max(0.0, abs(mvPosition.x / 25.) - fintensity);"," vec3 field = getField(ftex, ftrans, finvTrans, mvPosition.xyz, fgrid, intensity);"," field.y *= 3.0;"," gl_Position = projectionMatrix * viewMatrix * (mvPosition + vec4(field, 0.0));","}"].join("\n"),fragmentShader:["uniform sampler2D audio;","varying vec2 vUv;","void main() {"," float alpha = min(1.0, abs(texture2D( audio, vec2(vUv.x, 0.0) ).r * 1000.));","	gl_FragColor = vec4( 1.0, 1.0, 1.0, alpha );","}"].join("\n"),transparent:!0,depthTest:!1}),d=2048,u=new i.BufferGeometry,s=new Float32Array(3*d),l=new Float32Array(2*d),f=0;d>f;f++){var m=-30+f/d*60,c=3.5,p=30;s[3*f]=m,s[3*f+1]=c,s[3*f+2]=p,l[2*f]=f/d,l[2*f+1]=f/d}u.addAttribute("position",new i.BufferAttribute(s,3)),u.addAttribute("uv",new i.BufferAttribute(l,2)),u.computeBoundingSphere();var g=new i.Line(u,v);a.scene.add(g),window.addEventListener("resize",function(){a.width=window.innerWidth,a.height=Math.floor(a.width/2)}),a.onResultChanged=function(e){this.$.animation.addAnimation(this.scene,e.detail.value)};var h=function(){v.uniforms.ftex.value=field.texture,v.uniforms.ftrans.value=field.uniforms.ftrans.value,v.uniforms.finvTrans.value=field.uniforms.finvTrans.value,v.uniforms.audio.value=a.$.voice.waveHistoryTexture,o.uniforms.audio.value=a.$.voice.levelHistoryTexture,requestAnimationFrame(h),a.$.animation.update(),a.$.voice.update(),a.$.renderer.clear(),a.$.renderer.render(a.scene,a.camera)};a.addEventListener("dom-change",function(){h()})}(document,THREE),function(e,i){var a=e.querySelector("#app");a.width=window.innerWidth,a.height=Math.floor(a.width/2),a.scene=new i.Scene,a.camera=new i.PerspectiveCamera(90,2,.1,1e3),a.camera.position.set(0,4,40),a.camera.lookAt(new i.Vector3);var t=i.ImageUtils.loadTexture("images/grid.png");t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,t.anisotropy=6;var r=i.ImageUtils.loadTexture("images/displace.jpg"),o=new i.ShaderMaterial({uniforms:{map:{type:"t",value:t},displace:{type:"t",value:r},audio:{type:"t",value:null}},vertexShader:["uniform sampler2D displace;","uniform sampler2D audio;","varying vec2 vUv;","varying float dist;","void main() {"," vUv = uv;"," dist = distance(uv * vec2(1.0, 0.5), vec2(0.35, 0.05));"," float audioColor = texture2DLod( audio, vec2(dist, 0.0), 2.0 ).r;"," float offset = texture2D( displace, uv ).r * 45.0 + audioColor * 4.0;"," vec4 mvPosition = modelViewMatrix * vec4( position + vec3(0.0, 0.0, offset), 1.0 );"," gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform sampler2D map;","uniform sampler2D audio;","varying vec2 vUv;","varying float dist;","void main() {"," vec4 texelColor = 10.0 * texture2D( map, vUv * vec2(150.0, 75.0) );"," float audioColor = texture2D( audio, vec2(dist, 0.0) ).r;","	gl_FragColor = vec4( texelColor.rgb * (1.0 + 10.0 * audioColor), 1.0 );","}"].join("\n")}),n=new i.Mesh(new i.PlaneBufferGeometry(150,75,150,75),o);n.rotation.x=-Math.PI/2,n.position.y=0,a.scene.add(n);for(var v=new i.ShaderMaterial({uniforms:i.UniformsUtils.merge([{audio:{type:"t",value:null}},field.uniforms]),vertexShader:[field.shaderChunk.params,"uniform sampler2D audio;",field.shaderChunk.functions,"varying vec2 vUv;","void main() {","vUv = uv;"," float offset = texture2D( audio, vec2(uv.x, 0.0) ).r * 22.;"," vec4 mvPosition = modelMatrix * vec4( position + vec3(0.0, offset, 0.0), 1.0 );"," float intensity = max(0.0, abs(mvPosition.x / 25.) - fintensity);"," vec3 field = getField(ftex, ftrans, finvTrans, mvPosition.xyz, fgrid, intensity);"," field.y *= 3.0;"," gl_Position = projectionMatrix * viewMatrix * (mvPosition + vec4(field, 0.0));","}"].join("\n"),fragmentShader:["uniform sampler2D audio;","varying vec2 vUv;","void main() {"," float alpha = min(1.0, abs(texture2D( audio, vec2(vUv.x, 0.0) ).r * 1000.));","	gl_FragColor = vec4( 1.0, 1.0, 1.0, alpha );","}"].join("\n"),transparent:!0,depthTest:!1}),d=2048,u=new i.BufferGeometry,s=new Float32Array(3*d),l=new Float32Array(2*d),f=0;d>f;f++){var m=-30+f/d*60,c=3.5,p=30;s[3*f]=m,s[3*f+1]=c,s[3*f+2]=p,l[2*f]=f/d,l[2*f+1]=f/d}u.addAttribute("position",new i.BufferAttribute(s,3)),u.addAttribute("uv",new i.BufferAttribute(l,2)),u.computeBoundingSphere();var g=new i.Line(u,v);a.scene.add(g),window.addEventListener("resize",function(){a.width=window.innerWidth,a.height=Math.floor(a.width/2)}),a.onResultChanged=function(e){this.$.animation.addAnimation(this.scene,e.detail.value)};var h=function(){v.uniforms.ftex.value=field.texture,v.uniforms.ftrans.value=field.uniforms.ftrans.value,v.uniforms.finvTrans.value=field.uniforms.finvTrans.value,v.uniforms.audio.value=a.$.voice.waveHistoryTexture,o.uniforms.audio.value=a.$.voice.levelHistoryTexture,requestAnimationFrame(h),a.$.animation.update(),a.$.voice.update(),a.$.renderer.clear(),a.$.renderer.render(a.scene,a.camera)};a.addEventListener("dom-change",function(){h()})}(document,THREE);