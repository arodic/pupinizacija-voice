!function(){var e=document.querySelector("#app");e.width=window.innerWidth,e.height=window.innerHeight;var a={minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBFormat},i=new THREE.WebGLRenderTarget(e.width,e.height,a),r=new THREE.WebGLRenderTarget(e.width,e.height,a),t=new THREE.Scene,n=new THREE.Mesh(new THREE.PlaneBufferGeometry(1,1),new THREE.MeshBasicMaterial({map:i,alphaMap:THREE.ImageUtils.loadTexture("images/maskLeft.png"),transparent:!0}));n.position.x=-.5,t.add(n);var o=new THREE.Mesh(new THREE.PlaneBufferGeometry(1,1),new THREE.MeshBasicMaterial({map:r,alphaMap:THREE.ImageUtils.loadTexture("images/maskRight.png"),transparent:!0}));o.position.x=.5,t.add(o);var d=new THREE.OrthographicCamera(-1,1,.5,-.5,-100,100);e.scene=new THREE.Scene,e.camera=new THREE.PerspectiveCamera(90,e.width/e.height,.1,1e3),e.camera.position.set(0,4,40),e.camera.lookAt(new THREE.Vector3);var s=THREE.ImageUtils.loadTexture("images/grid.png");s.wrapS=THREE.RepeatWrapping,s.wrapT=THREE.RepeatWrapping,s.anisotropy=6;var l=THREE.ImageUtils.loadTexture("images/displace.jpg"),u=new THREE.ShaderMaterial({uniforms:{map:{type:"t",value:s},displace:{type:"t",value:l},audio:{type:"t",value:null}},vertexShader:["uniform sampler2D displace;","uniform sampler2D audio;","varying vec2 vUv;","varying float dist;","void main() {"," vUv = uv;"," dist = distance(uv * vec2(1.0, 0.5), vec2(0.35, 0.05));"," float audioColor = texture2DLod(audio, vec2(dist, 0.0), 2.0).r;"," float offset = texture2D(displace, uv).r * 45.0 + audioColor * 4.0;"," vec4 mvPosition = modelViewMatrix * vec4(position + vec3(0.0, 0.0, offset), 1.0);"," gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform sampler2D map;","uniform sampler2D audio;","varying vec2 vUv;","varying float dist;","void main() {"," vec4 texelColor = 10.0 * texture2D(map, vUv * vec2(150.0, 75.0));"," float audioColor = texture2D(audio, vec2(dist, 0.0)).r;","	gl_FragColor = vec4(texelColor.rgb * (1.0 + 10.0 * audioColor), 1.0);","}"].join("\n")}),v=new THREE.Mesh(new THREE.PlaneBufferGeometry(150,75,150,75),u);v.rotation.x=-Math.PI/2,v.position.y=0,e.scene.add(v);for(var m=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.merge([{audio:{type:"t",value:null}},field.uniforms]),vertexShader:[field.shaderChunk.params,"uniform sampler2D audio;",field.shaderChunk.functions,"varying vec2 vUv;","void main() {","vUv = uv;"," float offset = texture2D(audio, vec2(uv.x, 0.0)).r * 8.;"," vec4 mvPosition = modelMatrix * vec4(position + vec3(0.0, offset, 0.0), 1.0);"," float intensity = max(0.0, abs(mvPosition.x / 25.) - fintensity);"," vec3 field = getField(ftex, ftrans, finvTrans, mvPosition.xyz, fgrid, intensity);"," field.y *= 3.0;"," gl_Position = projectionMatrix * viewMatrix * (mvPosition + vec4(field, 0.0));","}"].join("\n"),fragmentShader:["uniform sampler2D audio;","varying vec2 vUv;","void main() {"," float alpha = min(1.0, abs(texture2D(audio, vec2(vUv.x, 0.0)).r * 1000.));","	gl_FragColor = vec4(1.0, 1.0, 1.0, alpha);","}"].join("\n"),transparent:!0,depthTest:!1}),f=2048,h=new THREE.BufferGeometry,c=new Float32Array(3*f),E=new Float32Array(2*f),p=0;f>p;p++){var g=-30+p/f*60,w=3.5,T=30;c[3*p]=g,c[3*p+1]=w,c[3*p+2]=T,E[2*p]=p/f,E[2*p+1]=p/f}h.addAttribute("position",new THREE.BufferAttribute(c,3)),h.addAttribute("uv",new THREE.BufferAttribute(E,2)),h.computeBoundingSphere();var R=new THREE.Line(h,m);e.scene.add(R),window.addEventListener("resize",function(){e.width=window.innerWidth,e.height=window.innerHeight,i=new THREE.WebGLRenderTarget(e.width,e.height,a),r=new THREE.WebGLRenderTarget(e.width,e.height,a),n.material.map=i,o.material.map=r,e.camera.aspect=e.width/e.height,e.camera.updateProjectionMatrix()}),e.onResultChanged=function(e){this.$.animation.addAnimation(this.scene,e.detail.value)};var H=function(){m.uniforms.ftex.value=field.texture,m.uniforms.ftrans.value=field.uniforms.ftrans.value,m.uniforms.finvTrans.value=field.uniforms.finvTrans.value,m.uniforms.audio.value=e.$.voice.waveHistoryTexture,u.uniforms.audio.value=e.$.voice.levelHistoryTexture,requestAnimationFrame(H),e.$.animation.update(),e.$.voice.update(),e.$.renderer.autoClear=!0,e.$.renderer.autoClearDepth=!0,e.$.renderer.autoClearColor=!0,e.$.renderer.autoClearAlpha=!0,e.$.renderer.autoClearStencil=!0,e.$.renderer.clear();var a=1.05;e.camera.setViewOffset(e.width,e.height,0,0,e.width/2*a,e.height),e.$.renderer.render(e.scene,e.camera,i,!0),e.camera.setViewOffset(e.width,e.height,e.width/2-a,0,e.width/2*a,e.height),e.$.renderer.render(e.scene,e.camera,r,!0),e.$.renderer.render(t,d)};e.addEventListener("dom-change",function(){H()})}();